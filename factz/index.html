<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>gFactz</title>

  <!-- SEO & Social Meta -->
  <meta name="description" content="Fact Check Tool to quickly verify claims using trusted sources like BBC, PolitiFact, and more." />
  <meta property="og:title" content="Fact Check Tool" />
  <meta property="og:description" content="Verify news claims and headlines with trusted fact-checking databases." />
  <meta property="og:type" content="website" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.5.9/dist/typography.min.css" rel="stylesheet" />

  <!-- Marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* Spinner for loading */
    .spinner {
      border: 3px solid transparent;
      border-top-color: white;
      border-radius: 50%;
      width: 1em;
      height: 1em;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 0.5em;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Fade-in animation for results */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out both;
    }

    /* Visually hidden class for accessibility */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      border: 0;
    }

    /* Add bottom margin on Buy Me Coffee CTA on small screens */
    @media (max-width: 640px) {
      .buy-coffee-cta {
        margin-bottom: 1.5rem;
      }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-tr from-indigo-50 via-white to-indigo-50 p-6 flex flex-col items-center font-sans dark:bg-gray-900 dark:text-indigo-300">

  <h1 class="text-4xl font-extrabold text-indigo-700 mb-1 drop-shadow-md dark:text-indigo-300">gFactz</h1>
  <p class="text-sm text-indigo-500 mb-6 italic select-none dark:text-indigo-400">
    by
    <a href="https://github.com/ScribeAegis" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:underline dark:text-indigo-400">Jason 'j4g' G.</a>
  </p>

  <!-- How this tool works -->
  <section class="max-w-3xl w-full mb-8 p-6 bg-indigo-50 rounded-lg shadow-md text-indigo-900 prose dark:bg-gray-800 dark:text-indigo-300">
    <h2 class="font-bold uppercase">How this tool works:</h2>
    <p>Enter a claim, headline, or statement you want to verify. This tool searches trusted fact-checking databases to find relevant reviews and verdicts.</p>
    <p>It uses the Google Fact Check Tools API, aggregating information from reputable publishers like BBC, FactCheck.org, PolitiFact, and more.</p>
    <p>This helps you quickly spot misinformation before sharing or acting on sensitive topics — especially important for health and safety related news.</p>
    <p><em>Your queries are not stored — privacy is respected.</em></p>
  </section>

  <!-- Why I built this -->
  <section class="max-w-3xl w-full mb-8 p-6 bg-indigo-50 rounded-lg shadow-md text-indigo-900 prose dark:bg-gray-800 dark:text-indigo-300">
    <h2 class="font-bold uppercase">Why I built this:</h2>
    <p>I'm tired of watching misinformation — especially around health and public safety — spread unchecked across social media and news feeds. Misleading headlines and false claims can do real harm.</p>
    <p>This tool was created to help you quickly verify information before sharing it.</p>
    <p>We deserve tools that prioritize truth, clarity, and critical thinking.</p>
    <p>This is my contribution to that cause.</p>
  </section>

  <!-- Buy Me A Coffee CTA -->
  <div class="buy-coffee-cta mt-6 p-4 bg-indigo-100 rounded-md text-indigo-800 text-center dark:bg-gray-700 dark:text-indigo-300">
    <p class="mb-2 font-semibold">If you find this tool useful, consider supporting my work as an open-source developer!</p>
    <a href="https://coff.ee/j4gwire" target="_blank" rel="noopener noreferrer" class="inline-block px-5 py-2 rounded bg-yellow-400 hover:bg-yellow-500 text-indigo-900 font-bold transition">
      ☕ Buy Me a Coffee
    </a>
  </div>

  <!-- Search Form -->
  <form id="factcheck-form" class="w-full max-w-3xl flex flex-col sm:flex-row gap-4 mb-4" novalidate>
    <label for="query" class="sr-only">Enter claim or headline</label>
    <input
      type="text"
      id="query"
      aria-label="Enter claim or headline"
      placeholder="Enter claim or headline"
      class="flex-grow min-w-[150px] p-4 rounded-lg border border-indigo-300 shadow-sm focus:outline-none focus:ring-4 focus:ring-indigo-400 transition dark:bg-gray-900 dark:border-indigo-600 dark:text-indigo-300"
      required
      autocomplete="off"
    />
    <button
      type="submit"
      id="submit-btn"
      class="w-full sm:w-auto px-6 py-4 rounded-lg bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition flex items-center justify-center disabled:opacity-50"
    >
      <span id="check-btn-label">Check Claim</span>
    </button>
    <button
      type="button"
      id="clear-btn"
      class="w-full sm:w-auto px-6 py-4 rounded-lg bg-gray-300 text-gray-700 font-semibold hover:bg-gray-400 transition dark:bg-gray-700 dark:text-indigo-300 dark:hover:bg-gray-600"
    >
      Clear
    </button>
  </form>

  <!-- Query Display -->
  <div id="user-query" class="max-w-3xl w-full mb-8 p-4 bg-indigo-100 rounded-md text-indigo-700 font-semibold text-center hidden dark:bg-gray-700 dark:text-indigo-300"></div>

  <!-- Divider -->
  <hr class="w-full max-w-3xl border-indigo-300 mb-8 dark:border-indigo-700" />

  <!-- Messages -->
  <div id="error-msg" class="max-w-3xl w-full p-4 mb-6 text-red-800 bg-red-100 rounded shadow hidden" role="alert"></div>
  <div id="no-results-msg" class="max-w-3xl w-full p-4 mb-6 text-yellow-900 bg-yellow-100 rounded shadow hidden" role="status">No fact checks found for your claim.</div>

  <!-- Fact Results -->
  <div id="results" class="max-w-3xl w-full space-y-8"></div>

  <!-- Pagination Controls -->
  <div id="pagination-controls" class="max-w-3xl w-full flex justify-center items-center gap-4 mb-8 text-indigo-700 dark:text-indigo-300 hidden">
    <button id="prev-page-btn" class="px-4 py-2 rounded bg-indigo-600 text-white font-semibold hover:bg-indigo-700 disabled:opacity-50" disabled aria-label="Previous page">
      &larr; Previous
    </button>
    <span>Page <span id="current-page">1</span></span>
    <button id="next-page-btn" class="px-4 py-2 rounded bg-indigo-600 text-white font-semibold hover:bg-indigo-700 disabled:opacity-50" disabled aria-label="Next page">
      Next &rarr;
    </button>
  </div>

  <script>
    "use strict";

    // DOM elements
    const form = document.getElementById("factcheck-form");
    const queryInput = document.getElementById("query");
    const resultsDiv = document.getElementById("results");
    const errorMsg = document.getElementById("error-msg");
    const noResultsMsg = document.getElementById("no-results-msg");
    const userQueryDiv = document.getElementById("user-query");
    const clearBtn = document.getElementById("clear-btn");
    const submitBtn = document.getElementById("submit-btn");
    const checkBtnLabel = document.getElementById("check-btn-label");

    const paginationControls = document.getElementById("pagination-controls");
    const prevPageBtn = document.getElementById("prev-page-btn");
    const nextPageBtn = document.getElementById("next-page-btn");
    const currentPageSpan = document.getElementById("current-page");

    const API_KEY = "AIzaSyCwNI-18i8R_1gHOlpEW9Q8QLqeMyUjoek";  // Replace with your real key in production
    const API_BASE_URL = "https://factchecktools.googleapis.com/v1alpha1/claims:search";

    // Pagination state
    let pageTokens = [null]; // pageTokens[0] = null for first page
    let currentPage = 1;
    let currentQuery = "";

    // Disable right-click globally
    document.addEventListener("contextmenu", e => e.preventDefault());

    // Submit form handler
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const query = queryInput.value.trim();
      if (!query) return;

      currentQuery = query;
      pageTokens = [null];  // reset tokens stack for new query
      currentPage = 1;

      resetUI();
      userQueryDiv.classList.remove("hidden");
      userQueryDiv.textContent = `Your query: "${query}"`;

      paginationControls.classList.add("hidden");

      await fetchClaims({ query, pageToken: null });
    });

    // Clear button handler
    clearBtn.addEventListener("click", () => {
      queryInput.value = "";
      currentQuery = "";
      pageTokens = [null];
      currentPage = 1;
      resetUI();
      queryInput.focus();
      paginationControls.classList.add("hidden");
      errorMsg.classList.add("hidden");
      noResultsMsg.classList.add("hidden");
    });

    // Previous page button
    prevPageBtn.addEventListener("click", async () => {
      if (currentPage <= 1) return;
      currentPage--;
      await fetchClaims({ query: currentQuery, pageToken: pageTokens[currentPage - 1] });
    });

    // Next page button
    nextPageBtn.addEventListener("click", async () => {
      const token = pageTokens[currentPage];
      if (!token) return;
      currentPage++;
      await fetchClaims({ query: currentQuery, pageToken: token });
    });

    // Reset UI to initial state
    function resetUI() {
      resultsDiv.innerHTML = "";
      errorMsg.classList.add("hidden");
      noResultsMsg.classList.add("hidden");
      userQueryDiv.classList.add("hidden");
      paginationControls.classList.add("hidden");
      submitBtn.disabled = false;
      checkBtnLabel.textContent = "Check Claim";
    }

    // Fetch claims from Google Fact Check API
    async function fetchClaims({ query, pageToken }) {
      try {
        submitBtn.disabled = true;
        checkBtnLabel.innerHTML = `<span class="spinner" aria-hidden="true"></span>Loading...`;
        errorMsg.classList.add("hidden");
        noResultsMsg.classList.add("hidden");

        const url = new URL(API_BASE_URL);
        url.searchParams.set("key", API_KEY);
        url.searchParams.set("query", query);
        if (pageToken) url.searchParams.set("pageToken", pageToken);

        const response = await fetch(url.toString());
        if (!response.ok) {
          throw new Error(`HTTP error ${response.status}`);
        }
        const data = await response.json();

        if (!data.claims || data.claims.length === 0) {
          if (!pageToken) {
            noResultsMsg.classList.remove("hidden");
          }
          paginationControls.classList.add("hidden");
          submitBtn.disabled = false;
          checkBtnLabel.textContent = "Check Claim";
          return;
        }

        // Clear results on each fetch (including pagination)
        resultsDiv.innerHTML = "";

        // If this is a new search (pageToken null), reset pageTokens
        if (pageToken === null) {
          pageTokens = [null];
          currentPage = 1;
        }

        // If fetching a page beyond currentPage, add token to pageTokens
        if (pageToken !== null) {
          // Store token for this page (index = currentPage)
          pageTokens[currentPage - 1] = pageToken;
        }

        renderResults(data.claims);
        updatePageDisplay();

        // Enable/disable pagination buttons
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = !data.nextPageToken;

        // Save next page token (index currentPage)
        if (data.nextPageToken) {
          pageTokens[currentPage] = data.nextPageToken;
        }

        paginationControls.classList.remove("hidden");

      } catch (error) {
        if (error.message.startsWith("HTTP error")) {
          errorMsg.textContent = `Network error: ${error.message}`;
        } else {
          errorMsg.textContent = `Error: ${error.message || "Unknown error"}`;
        }
        errorMsg.classList.remove("hidden");
      } finally {
        submitBtn.disabled = false;
        checkBtnLabel.textContent = "Check Claim";
      }
    }

    // Update page number display
    function updatePageDisplay() {
      currentPageSpan.textContent = currentPage;
    }

    // Render the list of claims
    function renderResults(claims) {
      claims.forEach(claim => {
        const div = document.createElement("div");
        div.className = "fade-in p-4 border border-indigo-200 bg-white rounded shadow dark:bg-gray-800 dark:border-indigo-600";

        const text = document.createElement("p");
        text.className = "font-semibold text-indigo-900 mb-2 dark:text-indigo-300";
        text.textContent = claim.text || "No claim text";
        div.appendChild(text);

        if (claim.claimReview) {
          claim.claimReview.forEach(review => {
            const section = document.createElement("div");
            section.className = "mt-3 border-t pt-2 border-indigo-100 dark:border-indigo-700";

            const verdict = review.textualRating || "Unknown";
            const color =
              verdict.toLowerCase().includes("false") ? "text-red-600 font-bold" :
              verdict.toLowerCase().includes("true") ? "text-green-600 font-bold" :
              "text-yellow-600";

            section.innerHTML = `
              <p><strong>Publisher:</strong> ${sanitize(review.publisher?.name || "Unknown")}</p>
              <p><strong>Verdict:</strong> <span class="${color}">${sanitize(verdict)}</span></p>
              ${review.title ? `<p class="italic text-indigo-600 dark:text-indigo-300">${sanitize(review.title)}</p>` : ""}
              ${review.reviewDate ? `<p class="text-sm text-indigo-400 dark:text-indigo-500">Reviewed on: ${new Date(review.reviewDate).toLocaleDateString()}</p>` : ""}
              ${review.url ? `<a href="${sanitizeUrl(review.url)}" target="_blank" rel="noopener noreferrer" class="text-indigo-700 hover:underline dark:text-indigo-300">Read full review</a>` : ""}
            `;
            div.appendChild(section);
          });
        }

        resultsDiv.appendChild(div);
      });
    }

    // Sanitize inner text to avoid XSS
    function sanitize(text) {
      const div = document.createElement("div");
      div.textContent = text;
      return div.innerHTML;
    }

    // Sanitize URLs to avoid XSS
    function sanitizeUrl(url) {
      try {
        const parsed = new URL(url);
        return ["http:", "https:"].includes(parsed.protocol) ? url : "#";
      } catch {
        return "#";
      }
    }
  </script>
  <footer class="bg-gray-100 dark:bg-gray-900 text-sm text-gray-600 dark:text-gray-400 mt-12 p-4 text-center border-t border-gray-200 dark:border-gray-700">
  <p class="mb-2">
    © 2025 Jason G. • Open Source under <a href="https://opensource.org/licenses/MIT" class="text-indigo-600 hover:underline dark:text-indigo-400" target="_blank">MIT License</a>
  </p>
  <p class="mb-2">
    Powered by <a href="https://toolbox.google.com/factcheck/apis" class="text-indigo-600 hover:underline dark:text-indigo-400" target="_blank">Google Fact Check API</a>
  </p>
  <p class="mb-2">
    <a href="https://github.com/your-repo-link" class="text-indigo-600 hover:underline dark:text-indigo-400" target="_blank">View Source on GitHub</a>
  </p>
  <p class="text-xs mt-2 italic">
    This tool is not affiliated with Google or any fact-checking organizations.
  </p>
</footer>
</body>
</html>
